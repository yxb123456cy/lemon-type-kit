#!/usr/bin/env sh

. "$(dirname -- "$0")/_/husky.sh"




# 开启严格模式：任何命令失败则立即退出（避免脏提交）

set -e




echo "🍋 lemon-type-kit pre-commit 检查开始..."




# ==============================================

# 1. 优先执行：TypeScript 类型全量检查（阻断类型错误）

# ==============================================

echo "🔍 检查 TS 类型..."

pnpm type-check  # 对应 package.json 中 "type-check": "tsc --noEmit"

echo "✅ TS 类型检查通过"







# ==============================================

# 2. 核心：用 lint-staged 处理暂存区文件（格式化+lint+测试）

# ==============================================

echo "🧹 处理暂存区文件（格式化+lint+相关测试）..."

# 调用 lint-staged（已在 package.json 配置：对暂存区 TS/JS 文件执行 Biome 检查和 Vitest 相关测试）

npx lint-staged

echo "✅ 暂存区文件处理完成"







# ==============================================

# 3. 补充：全量测试（可选，根据项目规模决定）

# ==============================================

# 若工具库规模小（30个API），可跳过全量测试；若需严格保障，保留此步

echo "🧪 运行全量测试..."

pnpm test:unit  # 对应 package.json 中 "test": "vitest run"

echo "✅ 全量测试通过"







# ==============================================

# 4. 收尾：提示成功，增强开发体验

# ==============================================

echo "🎉 lemon-type-kit 代码检查通过，允许提交！"